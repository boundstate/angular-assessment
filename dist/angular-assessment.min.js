/**
 * angular-assessment - v0.0.14 - 2020-03-22
 *
 * Copyright (c) 2020 Bound State Software
 */
!function(a,b,c){b.module("boundstate.assessment",["ngSanitize","templates-main","boundstate.scrollToMe"]),b.module("boundstate.assessment").directive("assessment",["assessment",function(a){return{restrict:"AE",scope:{offset:"="},link:function(b,c,d){b.questions=a.getQuestions()},templateUrl:"directive/assessment.tpl.html",replace:!0}}]),b.module("boundstate.assessment").directive("question",["$rootScope","assessment",function(a,c){return{restrict:"AE",scope:{},link:function(d,e,f){d.question=c.getQuestion(f.questionId),d.form={choices:{}};var g=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return!1},h=function(){d.isCurrent=d.question.id==c.getCurrentQuestion().id,d.form.answer=c.getAnswer(d.question.id),"multi-choice"==d.question.type&&b.isUndefined(d.form.answer)&&(d.form.answer=[])};a.$on("boundstate.assessment:answer_changed",h),h(),d.clickLink=function(b,c){a.$broadcast("boundstate.assessment:link_clicked",b,f.questionId,c)},d.setAnswer=function(a){c.setAnswer(d.question.id,a)},d.toggleMultiOption=function(a){var b=g(d.form.answer,a);b!==!1?d.form.answer.splice(b,1):d.form.answer.push(a),this.question.isAnswered()&&d.setAnswer(d.form.answer)},d.isMultiOptionSelected=function(a){return b.isUndefined(d.form.answer)?!1:g(d.form.answer,a)!==!1}},templateUrl:"directive/question.tpl.html",replace:!0}}]),b.module("boundstate.assessment").factory("Question",["$window",function(a){var d=a._,e=function(a){if(b.isUndefined(a.id))throw new Error("Question id must be specified");if(b.isUndefined(a.label))throw new Error("Question label must be specified");this.id=a.id,this.type=a.type||"choice",this.label=a.label,this.hint=a.hint,this.linkTitle=a.linkTitle,this.config=a,this.isEnabled=!1};return e.prototype.getSelectedOption=function(){return b.isDefined(this.answer)?d.find(this.options,{value:this.answer}):c},e.prototype.isAnswered=function(){return"choice"==this.type?b.isDefined(this.getSelectedOption()):"multi-choice"==this.type?b.isDefined(this.answer):b.isDefined(this.answer)&&this.answer.length>0},e.prototype.reload=function(a,b){("choice"==this.type||"multi-choice"==this.type)&&this._reloadOptions(a,b),this._reloadIsApplicable(a,b),this._reloadScore(a,b)},e.prototype._reloadOptions=function(a,c){for(var d=b.isFunction(this.config.options)?this.config.options(a,c):this.config.options,e=0;e<d.length;e++)b.isObject(d[e])||(d[e]={label:d[e],value:d[e]});this.options=d},e.prototype._reloadIsApplicable=function(a,c){b.isDefined(this.config.isApplicable)?this.isApplicable=this.config.isApplicable(a,c):this.isApplicable=!0},e.prototype._reloadScore=function(a,d){if(this.score=a,this.isAnswered()){var e="choice"==this.type?this.getSelectedOption():c;b.isDefined(e)&&b.isDefined(e.score)?this.score=e.score:b.isDefined(this.config.score)&&(this.score=this.config.score(this.answer,a,d))}},e}]),b.module("boundstate.assessment").provider("assessment",function(){var a=[{label:"Yes",value:"y"},{label:"No",value:"n"}],d=[];this.setDefaultQuestionOptions=function(b){a=b},this.setQuestions=function(a){if(!b.isArray(a))throw new Error("Questions must be an array");d=a},this.$get=["$rootScope","$window","Question",function(e,f,g){var h=null,i=!1,j=[],k=null,l=f._;b.forEach(d,function(c){if(l.find(j,{id:c.id}))throw new Error('A question with the id "'+c.id+'" is already defined');(b.isUndefined(c.type)||"text"==c.type)&&b.isUndefined(c.options)&&(c.options=a),j.push(new g(c))});var m={getScore:function(){return h},isComplete:function(){return i},getCurrentQuestion:function(){return k},getQuestions:function(){return j},getQuestion:function(a){return l.find(j,{id:a})},getQuestionIndex:function(a){return l.findIndex(j,{id:a})},isQuestionApplicable:function(a){var c=this.getQuestion(a);return b.isDefined(c)?c.isApplicable:!1},isQuestionEnabled:function(a){var c=this.getQuestion(a);return b.isDefined(c)?c.isEnabled:!1},setAnswer:function(a,b){var c=this.getQuestion(a);c.answer=b,this.reload(),e.$broadcast("boundstate.assessment:answer_changed")},getAnswer:function(a){var b=this.getQuestion(a);return b.isAnswered()?b.answer:c},getAnswers:function(){var a={};return l(j).filter(function(a){return a.isAnswered()}).forEach(function(b){a[b.id]=b.answer}),a},clearAnswers:function(){for(var a=0;a<j.length;a++)delete j[a].answer;this.reload(),e.$broadcast("boundstate.assessment:answer_changed")},reload:function(){var a=this,c=!0;h=null,b.forEach(j,function(b){b.reload(h,a),c&&b.isApplicable?(b.isEnabled=!0,h=b.score,k=b,c=b.isAnswered()):b.isEnabled=!1}),i=k.isAnswered()}};return m.reload(),m}]}),b.module("templates-main",["directive/assessment.tpl.html","directive/question.tpl.html"]),b.module("directive/assessment.tpl.html",[]).run(["$templateCache",function(a){a.put("directive/assessment.tpl.html",'<div class="assessment">\n  <div question ng-repeat="question in questions" question-id="{{question.id}}" offset="{{offset}}"></div>\n</div>')}]),b.module("directive/question.tpl.html",[]).run(["$templateCache",function(a){a.put("directive/question.tpl.html",'<div id="question-{{question.id}}" class="question question-{{ question.type }}" ng-show="question.isEnabled" ng-class="{ current: isCurrent && !question.isAnswered() }" scroll-to-me="isCurrent">\n  <div class="question-label" ng-bind-html="question.label"></div>\n <a class="question-link" ng-click="clickLink($event)" ng-bind-html="question.linkTitle"></a>\n  <div class="question-hint" ng-if="question.hint" ng-bind-html="question.hint"></div>\n  <div ng-if="question.type == \'multi-choice\'">\n    <div class="multi-choice" ng-repeat="option in question.options" ng-class="{ active: isMultiOptionSelected(option.value) }">\n      <label>\n        <input type="checkbox" ng-model="form.choices[\'choice-\' + $index]" ng-change="toggleMultiOption(option.value)"> {{ option.label }}\n        <a class="question-option-link" ng-click="clickLink($event, option.value)" ng-bind-html="option.linkTitle"></a>\n      </label>\n    </div>\n    <button type="button" ng-show="!question.isAnswered()" ng-click="setAnswer(form.answer)">Done</button>\n  </div>\n  <div ng-if="question.type == \'choice\'">\n    <div class="choice" ng-repeat="option in question.options" ng-class="{ active: option.value === form.answer }">\n      <label>\n        <input type="radio" ng-model="form.answer" ng-value="option.value" ng-change="setAnswer(form.answer)"> {{ option.label }}\n        <a class="question-option-link" ng-click="clickLink($event, option.value)"  ng-bind-html="option.linkTitle"></a>\n      </label>\n    </div>\n  </div>\n  <div class="text" ng-if="question.type == \'text\'">\n    <form ng-submit="setAnswer(form.answer);">\n      <input type="text" placeholder="{{ question.config.placeholder }}" ng-model="form.answer" ng-focus="hasFocus = true" ng-blur="setAnswer(form.answer); hasFocus = false">\n      <button type="submit" ng-show="hasFocus">Done</button>\n    </form>\n  </div>\n  <div class="text" ng-if="question.type == \'textarea\'">\n    <form ng-submit="setAnswer(form.answer);">\n      <textarea placeholder="{{ question.config.placeholder }}" ng-model="form.answer" ng-focus="hasFocus = true" ng-blur="setAnswer(form.answer); hasFocus = false"></textarea>\n      <button type="submit" ng-show="hasFocus">Done</button>\n    </form>\n  </div>\n</div>\n')}])}(window,window.angular);