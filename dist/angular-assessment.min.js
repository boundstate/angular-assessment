/**
 * angular-assessment - v0.0.2 - 2014-07-29
 *
 * Copyright (c) 2014 Bound State Software
 */
!function(a,b,c){b.module("boundstate.assessment",["templates-main"]),b.module("boundstate.assessment").directive("assessment",["assessment",function(a){return{restrict:"AE",scope:{},link:function(b){b.questions=a.getQuestions()},templateUrl:"directive/assessment.tpl.html",replace:!0}}]),b.module("boundstate.assessment").directive("question",["assessment",function(a){return{restrict:"AE",scope:{},link:function(b,c,d){b.question=a.getQuestion(d.questionId),b.isCurrent=b.question==a.currentQuestion,b.answer=a.getAnswer(b.question.id),b.changeAnswer=function(){a.setAnswer(b.question.id,b.answer)},b.$on("boundstate.assessment:answer_changed",function(){b.isCurrent=b.question==a.currentQuestion,b.answer=a.getAnswer(b.question.id)})},templateUrl:"directive/question.tpl.html",replace:!0}}]),b.module("boundstate.assessment").factory("Question",["$window",function(a){var d=a._,e=function(a){if(b.isUndefined(a.id))throw new Error("Question id must be specified");if(b.isUndefined(a.label))throw new Error("Question label must be specified");if(b.isUndefined(a.options))throw new Error("Question options must be specified");this.id=a.id,this.label=a.label,this.hint=a.hint,this.config=a,this.isEnabled=!1};return e.prototype.getSelectedOption=function(){return b.isDefined(this.answer)?d.find(this.options,{value:this.answer}):c},e.prototype.isAnswered=function(){return b.isDefined(this.getSelectedOption())},e.prototype.reload=function(a,b){this._reloadOptions(a,b),this._reloadIsApplicable(a,b),this._reloadScore(a,b)},e.prototype._reloadOptions=function(a,c){for(var d=b.isFunction(this.config.options)?this.config.options(a,c):this.config.options,e=0;e<d.length;e++)b.isObject(d[e])||(d[e]={label:d[e],value:d[e]});this.options=d},e.prototype._reloadIsApplicable=function(a,c){this.isApplicable=b.isDefined(this.config.isApplicable)?this.config.isApplicable(a,c):!0},e.prototype._reloadScore=function(a,c){if(this.score=a,this.isAnswered()){var d=this.getSelectedOption();b.isDefined(d.score)?this.score=d.score:b.isDefined(this.config.score)&&(this.score=this.config.score(this.answer,a,c))}},e}]),b.module("boundstate.assessment").provider("assessment",function(){var a=[{label:"Yes",value:"y"},{label:"No",value:"n"}],c=[];this.setDefaultQuestionOptions=function(b){a=b},this.setQuestions=function(a){if(!b.isArray(a))throw new Error("Questions must be an array");c=a},this.$get=["$rootScope","$window","Question",function(d,e,f){var g=[],h=e._;b.forEach(c,function(c){if(h.find(g,{id:c.id}))throw new Error('A question with the id "'+c.id+'" is already defined');b.isUndefined(c.options)&&(c.options=a),g.push(new f(c))});var i={score:null,currentQuestionIndex:null,getQuestions:function(){return g},getQuestion:function(a){return h.find(g,{id:a})},isQuestionApplicable:function(a){var c=this.getQuestion(a);return b.isDefined(c)?c.isApplicable:!1},isQuestionEnabled:function(a){var c=this.getQuestion(a);return b.isDefined(c)?c.isEnabled:!1},setAnswer:function(a,b){var c=this.getQuestion(a);c.answer=b,this.reload(),d.$broadcast("boundstate.assessment:answer_changed",b,c)},getAnswer:function(a){var b=this.getQuestion(a);return b.answer},reload:function(){var a=!0;this.score=null;for(var b=0;b<g.length;b++){var c=g[b],d=b>0?g[b-1]:null,e=d?d.score:null;c.reload(e,this),a&&c.isApplicable?(c.isEnabled=!0,this.score=c.score,this.currentQuestion=c,a=c.isAnswered()):c.isEnabled=!1}}};return i.reload(),i}]}),b.module("templates-main",["directive/assessment.tpl.html","directive/question.tpl.html"]),b.module("directive/assessment.tpl.html",[]).run(["$templateCache",function(a){a.put("directive/assessment.tpl.html",'<div class="assessment">\n  <div question ng-repeat="question in questions" question-id="{{question.id}}"></div>\n</div>')}]),b.module("directive/question.tpl.html",[]).run(["$templateCache",function(a){a.put("directive/question.tpl.html",'<div class="question" ng-show="question.isEnabled" ng-class="{ current: isCurrent && !answer }">\n  {{ question.label }}\n  <div class="question-hint" ng-if="question.hint">{{ question.hint }}</div>\n  <div class="radio" ng-repeat="option in question.options" ng-class="{ active: option.value === answer }">\n    <label>\n      <input type="radio" ng-model="$parent.answer" ng-value="option.value" ng-change="changeAnswer()"> {{ option.label }}\n    </label>\n  </div>\n</div>')}])}(window,window.angular);